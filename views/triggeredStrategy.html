<!DOCTYPE html>
<html lang="en">
<head>
<title>Home Page</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://moment.github.io/luxon/global/luxon.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@0.1.1"></script>
<script src="https://www.chartjs.org/chartjs-chart-financial/chartjs-chart-financial.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
<script src="https://moment.github.io/luxon/global/luxon.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.25/moment-timezone-with-data.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>	
<script src="https://unpkg.com/lodash@4.17.4"></script>
<script src="https://unpkg.com/d3-scale-chromatic@1.1.1"></script>
<!-- include polyfills for custom event, Symbol and Custom Elements -->
<script src="//unpkg.com/babel-polyfill@6.26.0/dist/polyfill.js"></script>
<script src="//unpkg.com/custom-event-polyfill@0.3.0/custom-event-polyfill.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/document-register-element/1.8.0/document-register-element.js"></script>
<!-- use babel so that we can use arrow functions and other goodness in this block! -->
<script src="//unpkg.com/babel-standalone@6/babel.min.js"></script>
<script src="//unpkg.com/d3@5.5.0"></script>
<script src="//unpkg.com/d3fc@14.0.41"></script>
<link href="https://unpkg.com/tabulator-tables@4.1.3/dist/css/tabulator.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet">
<link href="https://unpkg.com/tabulator-tables@4.1.3/dist/css/semantic-ui/tabulator_semantic-ui.min.css" rel="stylesheet">
<script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.1.3/dist/js/tabulator.min.js"></script>

<style>
    .loader {
      border: 10px solid #f3f3f3;
      border-radius: 50%;
      border-top: 10px solid #3498db;
      width: 50px;
      height: 50px;
      -webkit-animation: spin 2s linear infinite; /* Safari */
      animation: spin 2s linear infinite;
      position: fixed;
      left: 45%;
      top: 45%;
      transform: translate(-50%, -50%);
    }

    * {
      font-family: Sans-Serif;
    }

    h1 {
      font-size: 1.5em;
    }

    h2 {
      font-size: 1.25em;
    }

    body {
      background-color: white;
    }

    hr {
      margin-top: 1rem;
      margin-bottom: 1rem;
      border: 0;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
</style>

<script type="text/javascript">
$(document).ready( function () {
        var stockData = [];
        var server = window.location.port ? window.location.protocol +"//"+window.location.hostname +":"+window.location.port: window.location.protocol +"//"+window.location.hostname;
        var appliedStrategyListArr = [];
    
        getAllAppliedStrategyList();

        function getAllAppliedStrategyList()
        {
            appliedStrategyListArr = [];
            selectedSid = -1;
            var uid = localStorage.getItem('uid');
            $(".loader").show();
            $.get({
              url: server+'/getTriggeredList/'+uid,
              success: function(list){
                  $(".loader").hide();    
                  //console.log("list" + JSON.stringify(list));   
                  appliedStrategyListArr = list;
                  createTable();
                }
            });
        }
  
        function createTable()
        {
            //console.log("appliedStrategyListArr" + appliedStrategyListArr);
            var table = new Tabulator("#strategyTable", {
                  data:appliedStrategyListArr,
                  ajaxLoader: true,
                  ajaxLoaderLoading: 'updating data',
                  placeholder:"No Data Set",
                  height:"100%",
                  width:"90%",
                  layout:"fitDataFill",      //fit columns to width of table
                  tooltips:true,            //show tool tips on cells
                  history:true,             //allow undo and redo actions on the table
                  pagination:"local",       //paginate the data
                  paginationSize:20,         //allow 7 rows per page of data
                  movableColumns:true,      //allow column order to be changed

                  columns:[
                      {title:"Symbol", field:"symbol",widthShrink:1,width:220},
                      {title:"Exch.", field:"exchange",widthShrink:1,width:110},
                      {title:"Strategy name", field:"name",widthShrink:1,width:120},
                      {title:"Interval", field:"intervals",widthShrink:1,width:130},
                      {title:"Qty", field:"quantity",widthShrink:1,width:100},
                      {title:"Profit", field:"profit",widthShrink:1,width:100},
                      {title:"Entry Time", field:"entryTime",widthShrink:1,width:130},
                      {title:"Transaction", field:"transaction_type",widthShrink:1,width:180}
                    ]
              });
        }
    
});
</script>
</head>
<body>
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>                        
          </button>
        <a class="navbar-brand" href="#">Scanner</a>
      </div>
      <div class="collapse navbar-collapse" id="myNavbar">
        <ul class="nav navbar-nav">
         
          <li ><a href="/scanner">Scanner</a></li>
          <li ><a href="/strategy">Strategy</a></li>
          <li ><a href="/applyStrategy">Apply Strategy</a></li>  
          <li class="active"><a href="/Triggers">Triggers</a></li>
        </ul>
        <ul class="nav navbar-nav pull-right">
          <li class="dropdown pull-right"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Welcome, <span id="userTxt"></span> <span class="glyphicon glyphicon-user"></span><b class="caret"></b></a>
            <ul class="dropdown-menu pull-right">
                <li><a href="/profile"><i class="icon-cog"></i> Profile</a></li>
                <li><a href="/preferences"><i class="icon-envelope"></i> Preferences</a></li>
                <li class="divider"></li>
                <li><a href="/logout"><span class="glyphicon glyphicon-off"></span> Logout</a></li>
            </ul>
        </li>
      </ul>
      </div> 
    </div>
  </nav>
          
  <div class="container">
    <div class="row"></div>
    <br></br>
    <br></br>
      <div class="row">
        <div id="strategyListPanel" class="tab-pane fade in active">
          <br/>
            <div class="alert alert-info">  
                <p>All your live trigger symbols are listed below!</p>
            </div>
            <div id="strategyTable">
            </div>
        </div>
      </div>   
  </div>
  </div>
  <div class="loader"></div>
</body>
</html>